# Ona Context - ChurchTools Extension Development

## Project Overview
Vue 3 + TypeScript ChurchTools extension boilerplate with modular card-based architecture for rapid AI-assisted development.

## Critical API Patterns

### ChurchTools Client API ⚠️
**ALWAYS use correct pattern - common mistake to avoid:**

✅ **Correct:**
```typescript
churchtoolsClient.get('/api/endpoint', { param1: 'value1', param2: 'value2' })
```

❌ **Wrong:**
```typescript
churchtoolsClient.get('/api/endpoint', { params: { param1: 'value1' } })
```

**Key:** Second parameter is **directly** the params object, NOT nested in "params" key.

### ChurchTools Client HTTP Methods ⚠️
**CRITICAL: Use correct method names - common runtime error:**

✅ **Correct:**
```typescript
churchtoolsClient.get()       // GET requests
churchtoolsClient.post()      // POST requests  
churchtoolsClient.put()       // PUT requests
churchtoolsClient.deleteApi() // DELETE requests ⚠️ NOT .delete()!
churchtoolsClient.patch()     // PATCH requests
```

❌ **Wrong:**
```typescript
churchtoolsClient.delete()    // ERROR: "delete is not a function"
```

**Key:** DELETE operations use `deleteApi()` method, NOT `delete()`!

### Tags API Specifics ⚠️
**Modern Tags API returns data directly as array:**

✅ **Correct:**
```typescript
const response = await churchtoolsClient.get<Tag[]>('/tags/person')
// response is directly Tag[], not { data: Tag[] }
const tags = Array.isArray(response) ? response : []
```

❌ **Wrong:**
```typescript
const response = await churchtoolsClient.get('/tags/person')
const tags = response.data // ERROR: response.data is undefined
```

**Supported domains:** `'person' | 'song' | 'group'` (NOT `'appointment'`)

**Tag Updates:** Use `PUT /tags/{tagId}` with ALL required fields:
```typescript
const tagData = {
  name: tag.name,
  description: tag.description || '', // Required, use empty string not undefined
  color: tag.color || 'basic'          // Required, use default color not undefined
}
await churchtoolsClient.put(`/tags/${tagId}`, tagData)
```

## Project Structure
```
src/
├── components/
│   ├── common/           # Shared components (BaseCard, ColorPicker, Toast)
│   └── [module-name]/    # Feature modules (cards + admin components)
├── composables/          # Reusable Vue composition functions
├── services/            # API services and utilities
└── types/              # TypeScript definitions
```

## Development Guidelines

### Component Architecture
- Each module has Card + Admin components
- All cards extend BaseCard for consistency
- Import BaseCard from `../common/BaseCard.vue`
- ColorPicker available for ChurchTools color selection
- Use `v-model` for two-way binding with ColorPicker
- Toast system for user feedback

### Code Style
- Follow existing patterns in the codebase
- Use TypeScript strictly
- Maintain consistent import paths
- Use Vue 3 Composition API

### Git Workflow
- Use conventional commits: `feat:`, `fix:`, `refactor:`
- Add co-author: `Co-authored-by: Ona <no-reply@ona.com>`
- Never commit unless explicitly requested

### Vite Configuration
- .env files excluded from watch to prevent unnecessary restarts
- Dev server runs on port 5173
- Use exec_preview for development servers

## Common Pitfalls
1. **ChurchTools API**: Don't nest params in "params" object
2. **Tags API**: Response is direct array, not nested in "data" property
3. **Button types**: Always use `type="button"` to prevent form submission
4. **Import paths**: Update after component moves
5. **BaseCard imports**: Use relative paths from module directories

## API Documentation
- **ChurchTools OpenAPI Spec**: Check your ChurchTools instance at `/system/runtime/swagger/openapi.json`
  - Use this URL to check correct API endpoints, methods, and request/response schemas
  - Essential for debugging API integration issues

## Available Components

### BaseCard
Base component for all dashboard cards with consistent styling and structure.

### ColorPicker
ChurchTools-compatible color picker with:
- 4-column grid layout
- Round color swatches with white borders
- Color name and hex display
- "No Color" option
- v-model support

### Toast System
Modern notification system with:
- 4 types: success, error, warning, info
- Auto-dismiss functionality
- Smooth animations
- Global availability

### Composables
- `useToast`: Toast notification management
- `useTableSearch`: Table search functionality
- `useTableSorting`: Table sorting with custom comparators
- `useTableResize`: Responsive table handling

## ChurchTools Extension Development Best Practices

### 1. Extension Structure
```
your-extension/
├── index.html           # Entry point
├── package.json         # Dependencies and scripts
├── vite.config.ts       # Build configuration
├── .env-example         # Environment template
├── src/
│   ├── main.ts         # Vue app initialization
│   ├── App.vue         # Root component
│   └── components/     # Feature components
└── scripts/
    └── package.js      # Build packaging script
```

### 2. Environment Configuration
Create `.env` file with:
```
VITE_KEY=your-extension-key
VITE_CHURCHTOOLS_URL=https://your-instance.church.tools
```

### 3. ChurchTools Integration
- Extensions run in iframe context
- Use `window.parent.postMessage` for communication
- Access ChurchTools API via `churchtoolsClient`
- Follow ChurchTools design patterns

### 4. Development Workflow
1. Start with `npm run dev` for hot reload
2. Use browser dev tools for debugging
3. Test in actual ChurchTools environment
4. Build with `npm run deploy` for production

### 5. Common Extension Patterns
- **Dashboard Cards**: Display summary information
- **Admin Panels**: CRUD operations for data management
- **Reports**: Data visualization and export
- **Integrations**: Connect with external services

## AI Development Guidelines

### Prompt Engineering
When working with AI assistants:
1. Always reference this context file
2. Provide specific requirements and constraints
3. Request code that follows established patterns
4. Ask for TypeScript types and error handling
5. Ensure responsive design considerations

### Code Generation
AI should generate:
- Complete, runnable code
- Proper TypeScript types
- Error handling
- Consistent styling
- Documentation comments

### Testing Strategy
- Manual testing in development environment
- Cross-browser compatibility
- Mobile responsiveness
- ChurchTools integration testing

## Reference Files
- `docs/DEVELOPMENT_NOTES.md` - Detailed development guidelines
- `src/services/churchtools.ts` - Correct API usage examples
- `src/components/common/BaseCard.vue` - Base component architecture
- `src/components/common/ColorPicker.vue` - ChurchTools color picker
- `src/composables/useToast.ts` - Toast notification system

## Extension Deployment
1. Build: `npm run build`
2. Package: `npm run deploy`
3. Upload to ChurchTools admin panel
4. Configure extension settings
5. Test in production environment

---

**Remember:** This boilerplate provides a solid foundation for ChurchTools extension development with AI assistance. Follow the patterns, use the provided components, and leverage the composables for rapid development.